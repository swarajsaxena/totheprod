{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ttp-subscription-calendar",
  "type": "registry:block",
  "title": "Subscription Calendar",
  "description": "A calendar component that displays subscription details and allows users to manage their subscriptions",
  "dependencies": [
    "motion",
    "date-fns",
    "lucide-react"
  ],
  "files": [
    {
      "path": "components/ui/totheprod-ui/ttp-subscription-calendar.tsx",
      "content": "\"use client\"\n\nimport {\n  addDays,\n  addMonths,\n  eachDayOfInterval,\n  endOfMonth,\n  endOfWeek,\n  format,\n  isSameDay,\n  isSameMonth,\n  startOfMonth,\n  startOfWeek,\n  subMonths,\n} from \"date-fns\"\nimport { ChevronLeftIcon, ChevronRightIcon } from \"lucide-react\"\nimport { motion } from \"motion/react\"\nimport { useState } from \"react\"\nimport { useClickOutside } from \"@/hooks/totheprod-ui/use-click-outside\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"../button\"\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"../tooltip\"\n\nfunction getMonthGrid(date: Date) {\n  const start = startOfWeek(startOfMonth(date), { weekStartsOn: 1 })\n  const end = endOfWeek(endOfMonth(date), { weekStartsOn: 1 })\n  return eachDayOfInterval({ start, end })\n}\n\nconst isDayOfMonth = (date: Date, currentDate: Date) => {\n  return isSameMonth(date, currentDate)\n}\n\nfunction getDaysOfWeekLabels() {\n  const start = startOfWeek(new Date(), { weekStartsOn: 1 })\n  return Array.from({ length: 7 }).map((_, i) =>\n    format(addDays(start, i), \"EEE\")\n  )\n}\n\nexport type TSubscription = {\n  id: string\n  name: string\n  price: number\n  interval: \"monthly\" | \"yearly\"\n  status: \"active\" | \"inactive\"\n  date: Date\n  imageUrl: string\n}\n\nexport type TtpSubscriptionCalendarProps = {\n  subscriptions: TSubscription[]\n  /** Currency symbol or code to display (default: \"Rs\") */\n  currency?: string\n  /** Custom class name for the calendar container */\n  className?: string\n  /** Custom class name for individual day cells */\n  cellClassName?: string\n  /** Custom class name for the modal */\n  modalClassName?: string\n  /** Show/hide the month total (default: true) */\n  showMonthTotal?: boolean\n  /** Show/hide the subscription type indicators (default: true) */\n  showIndicators?: boolean\n  /** Custom colors for subscription types */\n  colors?: {\n    monthly?: string\n    yearly?: string\n    both?: string\n  }\n  /** Animation configuration */\n  animationConfig?: {\n    stiffness?: number\n    damping?: number\n  }\n  /** Custom render function for subscription items in modal */\n  renderSubscriptionItem?: (subscription: TSubscription) => React.ReactNode\n}\n\nconst baseCellClassNames = cn(\n  \"flex w-12 flex-col items-center justify-end gap-1 rounded-lg py-1 text-xs\"\n)\n\nconst DEFAULT_COLORS = {\n  monthly: \"bg-amber-500\",\n  yearly: \"bg-purple-500\",\n  both: \"bg-blue-500\",\n}\n\nexport const TtpSubscriptionCalendar = ({\n  subscriptions,\n  currency = \"Rs\",\n  className,\n  cellClassName,\n  modalClassName,\n  showMonthTotal = true,\n  showIndicators = true,\n  colors = DEFAULT_COLORS,\n  animationConfig = { stiffness: 300, damping: 30 },\n  renderSubscriptionItem,\n}: TtpSubscriptionCalendarProps) => {\n  const [currentDate, setCurrentDate] = useState(new Date())\n  const monthGrid = getMonthGrid(currentDate)\n\n  const daysOfWeek = getDaysOfWeekLabels()\n\n  const subscriptionsForCurrentMonth = subscriptions.filter((subscription) => {\n    if (subscription.interval === \"monthly\") {\n      // All monthly subscriptions count\n      return true\n    }\n    if (subscription.interval === \"yearly\") {\n      // Only yearly subscriptions in the same month\n      return subscription.date.getMonth() === currentDate.getMonth()\n    }\n    // Fallback to exact month match\n    return isSameMonth(subscription.date, currentDate)\n  })\n\n  const monthTotal = subscriptionsForCurrentMonth\n    .reduce((total, subscription) => total + subscription.price, 0)\n    .toFixed(2)\n\n  const getSubscriptionsForDay = (day: Date) => {\n    return subscriptions.filter((subscription) => {\n      // Check if subscription matches based on its interval\n      if (subscription.interval === \"monthly\") {\n        // Monthly: show on the same date of every month\n        return day.getDate() === subscription.date.getDate()\n      }\n      if (subscription.interval === \"yearly\") {\n        // Yearly: show on the same date and month every year\n        return (\n          day.getDate() === subscription.date.getDate() &&\n          day.getMonth() === subscription.date.getMonth()\n        )\n      }\n      // Fallback to exact date match\n      return isSameDay(subscription.date, day)\n    })\n  }\n\n  const MONTHLY_BACKGROUND = colors.monthly || DEFAULT_COLORS.monthly\n  const YEARLY_BACKGROUND = colors.yearly || DEFAULT_COLORS.yearly\n  const BOTH_BACKGROUND = colors.both || DEFAULT_COLORS.both\n\n  return (\n    <motion.div\n      animate={{ height: \"auto\" }}\n      className={cn(\n        \"relative flex flex-col gap-3 overflow-hidden rounded-2xl border border-border/50 bg-gray-50 p-4 dark:bg-gray-900\",\n        className\n      )}\n      transition={{\n        type: \"spring\",\n        stiffness: animationConfig.stiffness,\n        damping: animationConfig.damping,\n      }}\n    >\n      <div className=\"flex flex-col justify-between gap-1\">\n        <div className=\"flex items-start justify-between\">\n          <p className=\"font-medium text-lg leading-none\">\n            {format(currentDate, \"MMMM, yyyy\")}\n          </p>\n          <div className=\"flex gap-2\">\n            <Button\n              className=\"rounded-xs bg-transparent! p-0\"\n              onClick={() => setCurrentDate(subMonths(currentDate, 1))}\n              size=\"icon\"\n              variant=\"ghost\"\n            >\n              <ChevronLeftIcon className=\"size-4\" />\n            </Button>\n            <Button\n              className=\"rounded-xs bg-transparent! p-0\"\n              onClick={() => setCurrentDate(addMonths(currentDate, 1))}\n              size=\"icon\"\n              variant=\"ghost\"\n            >\n              <ChevronRightIcon className=\"size-4\" />\n            </Button>\n          </div>\n        </div>\n        {showIndicators && (\n          <div className=\"flex gap-2 text-[10px] text-muted-foreground\">\n            <p className=\"flex items-center gap-1\">\n              Monthly\n              <div\n                className={cn(\"size-1 rounded-full\", MONTHLY_BACKGROUND)}\n              />{\" \"}\n            </p>\n            <p className=\"flex items-center gap-1\">\n              Yearly\n              <div\n                className={cn(\"size-1 rounded-full\", YEARLY_BACKGROUND)}\n              />{\" \"}\n            </p>\n            <p className=\"flex items-center gap-1\">\n              Both\n              <div\n                className={cn(\"size-1 rounded-full\", BOTH_BACKGROUND)}\n              />{\" \"}\n            </p>\n            {showMonthTotal && (\n              <p className=\"ml-auto flex items-center gap-1 text-sm\">\n                Total:{\" \"}\n                <span className=\"font-medium\">\n                  {currency} {monthTotal}\n                </span>\n              </p>\n            )}\n          </div>\n        )}\n      </div>\n      <div className=\"flex flex-col gap-1\">\n        <div className=\"grid grid-cols-7 gap-1\">\n          {daysOfWeek.map((day) => (\n            <div\n              className={cn(\n                baseCellClassNames,\n                \"mb-1 bg-gray-100 py-1 text-muted-foreground dark:bg-gray-800\"\n              )}\n              key={day}\n            >\n              {day}\n            </div>\n          ))}\n          {monthGrid.map((day) => (\n            <TtpSubscriptionCalendarDay\n              animationConfig={animationConfig}\n              cellClassName={cellClassName}\n              colors={{\n                monthly: MONTHLY_BACKGROUND,\n                yearly: YEARLY_BACKGROUND,\n                both: BOTH_BACKGROUND,\n              }}\n              currency={currency}\n              day={day}\n              isDayOfMonth={isDayOfMonth(day, currentDate)}\n              key={day.toISOString()}\n              modalClassName={modalClassName}\n              renderSubscriptionItem={renderSubscriptionItem}\n              setCurrentDate={setCurrentDate}\n              showIndicators={showIndicators}\n              subscriptions={getSubscriptionsForDay(day)}\n            />\n          ))}\n        </div>\n      </div>\n    </motion.div>\n  )\n}\n\nconst TtpSubscriptionCalendarDay = ({\n  day,\n  subscriptions,\n  isDayOfMonth,\n  setCurrentDate,\n  currency,\n  cellClassName,\n  modalClassName,\n  showIndicators,\n  colors,\n  animationConfig,\n  renderSubscriptionItem,\n}: {\n  day: Date\n  subscriptions: TSubscription[]\n  isDayOfMonth: boolean\n  setCurrentDate: (date: Date) => void\n  currency: string\n  cellClassName?: string\n  modalClassName?: string\n  showIndicators: boolean\n  colors: {\n    monthly: string\n    yearly: string\n    both: string\n  }\n  animationConfig: {\n    stiffness?: number\n    damping?: number\n  }\n  renderSubscriptionItem?: (subscription: TSubscription) => React.ReactNode\n}) => {\n  const [isModalOpen, setIsModalOpen] = useState(false)\n  const containerRef = useClickOutside(() => {\n    setIsModalOpen(false)\n  })\n\n  const date = Number(format(day, \"dd\"))\n  const month = Number(format(day, \"MM\"))\n  const year = Number(format(day, \"yyyy\"))\n  const dateNumber = Number(`${date}${month}${year}${subscriptions.length}`)\n\n  const hasMonthlySubscription = subscriptions.some(\n    (subscription) => subscription.interval === \"monthly\"\n  )\n  const hasYearlySubscription = subscriptions.some(\n    (subscription) => subscription.interval === \"yearly\"\n  )\n\n  const hasBothSubscriptions = hasMonthlySubscription && hasYearlySubscription\n\n  const stiffness = animationConfig?.stiffness ?? 300\n  const damping = animationConfig?.damping ?? 30\n\n  const getIndicatorColor = () => {\n    if (hasBothSubscriptions) {\n      return colors.both\n    }\n    if (hasYearlySubscription) {\n      return colors.yearly\n    }\n    return colors.monthly\n  }\n\n  const handleClick = () => {\n    if (!isDayOfMonth) {\n      setCurrentDate(addDays(day, 0))\n    } else if (subscriptions.length > 0) {\n      setIsModalOpen(true)\n    }\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault()\n      handleClick()\n    }\n  }\n\n  const renderModal = () => (\n    <motion.div\n      className={cn(\n        \"-translate-1/2 absolute top-1/2 left-1/2 z-10 flex w-[75%] flex-col place-items-center gap-2 rounded-xl bg-gray-50 p-4 shadow-lg dark:bg-gray-900\",\n        modalClassName\n      )}\n      layoutId={`subscription-calendar-day-${dateNumber}`}\n      ref={containerRef}\n      transition={{\n        type: \"spring\",\n        stiffness,\n        damping: damping - 5,\n      }}\n    >\n      {subscriptions.map((subscription, index) =>\n        renderSubscriptionItem ? (\n          <div className=\"w-full\" key={subscription.id}>\n            {renderSubscriptionItem(subscription)}\n          </div>\n        ) : (\n          <motion.div\n            animate={{ opacity: 1, y: 0 }}\n            className=\"flex w-full items-center justify-between gap-1\"\n            initial={{ opacity: 0, y: -10 }}\n            key={subscription.id}\n            transition={{\n              delay: index * 0.1,\n              type: \"spring\",\n              stiffness,\n              damping: damping - 5,\n            }}\n          >\n            <div className=\"flex items-center gap-2\">\n              {/* biome-ignore lint/performance/noImgElement: motion.img doesn't support Image component */}\n              {/* biome-ignore lint/correctness/useImageSize: dynamic image sizes */}\n              <motion.img\n                alt={subscription.name}\n                className=\"size-6 rounded-md\"\n                layoutId={`subscription-calendar-day-${dateNumber}-${subscription.name}-image`}\n                src={subscription.imageUrl}\n              />\n              <div className=\"flex flex-col\">\n                <p className=\"font-medium text-muted-foreground text-xs leading-tight! dark:text-foreground/75\">\n                  {subscription.name}\n                </p>\n                <p className=\"text-[10px] text-muted-foreground/75 capitalize leading-tight! dark:text-foreground/50\">\n                  {subscription.interval}\n                </p>\n              </div>\n            </div>\n            <div className=\"text-foreground/75 text-xs\">\n              {currency} {subscription.price}\n            </div>\n          </motion.div>\n        )\n      )}\n      <div className=\"mt-2 flex w-full items-center justify-between gap-1 border-border border-t pt-4\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"flex flex-col\">\n            <p className=\"font-medium text-xs leading-tight!\">Total</p>\n          </div>\n        </div>\n        <div className=\"text-xs\">\n          {currency}{\" \"}\n          {subscriptions.reduce(\n            (prev, subscription) => prev + subscription.price,\n            0\n          )}\n        </div>\n      </div>\n    </motion.div>\n  )\n\n  const renderCell = () => (\n    <Tooltip>\n      <TooltipTrigger asChild>\n        <motion.div\n          animate={{ opacity: subscriptions.length > 0 ? 1 : 0.5 }}\n          className={cn(\n            baseCellClassNames,\n            \"asp relative h-12 w-full rounded-lg bg-gray-200 pt-2 transition-colors dark:bg-gray-800\",\n            subscriptions.length > 0\n              ? \"cursor-pointer hover:bg-gray-300 hover:dark:bg-gray-700\"\n              : \"cursor-not-allowed opacity-50\",\n            isModalOpen ? \"hover:bg-gray-200! dark:bg-gray-800!\" : \"\",\n            !isDayOfMonth &&\n              \"cursor-pointer border border-border bg-transparent!\",\n            cellClassName\n          )}\n          initial={{ opacity: 0 }}\n          layoutId={`subscription-calendar-day-${dateNumber}`}\n          transition={{\n            type: \"spring\",\n            stiffness,\n            damping: damping - 5,\n          }}\n        >\n          {isDayOfMonth && subscriptions.length > 0 && (\n            <>\n              {showIndicators && (\n                <div\n                  className={cn(\n                    \"absolute top-1 right-1 size-1 rounded-full\",\n                    getIndicatorColor()\n                  )}\n                />\n              )}\n              <div className=\"flex items-center\">\n                {subscriptions?.[0]?.imageUrl && (\n                  // biome-ignore lint/correctness/useImageSize: we don't need to know the size of the image\n                  // biome-ignore lint/performance/noImgElement: --\n                  <motion.img\n                    alt={subscriptions[0]?.name}\n                    className=\"size-4 rounded-full\"\n                    layoutId={`subscription-calendar-day-${dateNumber}-${subscriptions[0]?.name}-image`}\n                    src={subscriptions[0]?.imageUrl}\n                  />\n                )}\n                {subscriptions.length > 1 && (\n                  <div className=\"-ml-2 grid size-4 place-items-center rounded-full border border-gray-400 bg-gray-800 text-[6px] text-gray-50\">\n                    +{subscriptions.length - 1}\n                  </div>\n                )}\n              </div>\n            </>\n          )}\n          <span>{day.getDate()}</span>\n        </motion.div>\n      </TooltipTrigger>\n      {isDayOfMonth && subscriptions.length > 0 && (\n        <TooltipContent>\n          {subscriptions\n            .map((subscription) => {\n              return subscription.name\n            })\n            .join(\", \")}\n        </TooltipContent>\n      )}\n    </Tooltip>\n  )\n\n  return (\n    <>\n      {isModalOpen && (\n        <motion.div\n          animate={{ opacity: 1 }}\n          className=\"absolute inset-0 z-9 bg-gray-500/10 backdrop-blur-[1px] dark:bg-gray-200/10\"\n          initial={{ opacity: 0 }}\n          onClick={(e) => {\n            e.stopPropagation()\n            setIsModalOpen(false)\n          }}\n          transition={{\n            type: \"spring\",\n            stiffness: stiffness + 100,\n            damping,\n          }}\n        />\n      )}\n\n      <button\n        className=\"w-full border-none bg-transparent p-0 text-left\"\n        onClick={handleClick}\n        onKeyDown={handleKeyDown}\n        type=\"button\"\n      >\n        {isModalOpen ? renderModal() : renderCell()}\n      </button>\n    </>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "hooks/totheprod-ui/use-click-outside.ts",
      "content": "import { useEffect, useRef } from \"react\"\n\n/**\n * Custom hook to detect clicks outside of a specified element\n * @param customClick - Callback function to execute when clicking outside the element\n * @param options - Optional configuration\n * @param options.blockOutsideClicks - If true, prevents default behavior and stops propagation of outside clicks\n * @returns ref - Ref to attach to the element you want to detect outside clicks for\n *\n * @example\n * ```tsx\n * const MyComponent = () => {\n *   const ref = useClickOutside(() => {\n *     console.log('Clicked outside!');\n *   }, { blockOutsideClicks: true });\n *\n *   return <div ref={ref}>Click outside me</div>;\n * };\n * ```\n */\nexport function useClickOutside<T extends HTMLDivElement = HTMLDivElement>(\n  customClick: (event: MouseEvent | TouchEvent) => void,\n  options?: { blockOutsideClicks?: boolean }\n) {\n  const ref = useRef<T>(null)\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent | TouchEvent) => {\n      // Check if the click is outside the referenced element\n      if (ref.current && !ref.current.contains(event.target as Node)) {\n        // Block outside clicks if option is enabled\n        if (options?.blockOutsideClicks) {\n          event.preventDefault()\n          event.stopPropagation()\n        }\n\n        customClick(event)\n      }\n    }\n\n    // Add event listeners for both mouse and touch events\n    // Use capture phase to intercept events before they reach their targets\n    document.addEventListener(\"mousedown\", handleClickOutside, true)\n    document.addEventListener(\"touchstart\", handleClickOutside, true)\n\n    // Cleanup event listeners on unmount\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside, true)\n      document.removeEventListener(\"touchstart\", handleClickOutside, true)\n    }\n  }, [customClick, options?.blockOutsideClicks])\n\n  return ref\n}\n",
      "type": "registry:hook"
    }
  ],
  "meta": {
    "category": "data-display",
    "tags": [
      "calendar",
      "subscriptions",
      "management"
    ],
    "installCommand": "npx shadcn@latest add https://ui.totheprod.com/r/ttp-subscription-calendar.json"
  }
}