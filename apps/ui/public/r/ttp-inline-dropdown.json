{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ttp-inline-dropdown",
  "type": "registry:block",
  "title": "Inline Dropdown",
  "description": "A dropdown which opens right then and there",
  "dependencies": ["motion", "@radix-ui/react-dropdown-menu"],
  "files": [
    {
      "path": "components/ui/totheprod-ui/ttp-inline-dropdown.tsx",
      "content": "/** biome-ignore-all lint/complexity/noExcessiveCognitiveComplexity: its a dropdown */\n\"use client\"\n\nimport type * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { AnimatePresence, motion } from \"motion/react\"\nimport {\n  Children,\n  cloneElement,\n  createContext,\n  isValidElement,\n  type ReactElement,\n  type ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useId,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"../button\"\n\ntype InlineDropdownContextType = {\n  mode: \"icon\" | \"both\"\n  align: \"left\" | \"right\"\n  onItemSelect?: () => void\n}\n\nconst InlineDropdownContext = createContext<\n  InlineDropdownContextType | undefined\n>(undefined)\n\nexport const useInlineDropdownContext = () => {\n  const context = useContext(InlineDropdownContext)\n  if (!context) {\n    throw new Error(\n      \"InlineDropdown components must be used within TtpInlineDropdown\"\n    )\n  }\n  return context\n}\n\nexport type TtpInlineDropdownProps = {\n  /** The dropdown items to render */\n  children: ReactNode\n  /** Additional CSS classes to apply to the container */\n  className?: string\n  /** The ID of the item to show as the default trigger */\n  defaultItemId?: string\n  /** Display mode for the trigger button. Default: \"icon\" */\n  mode?: \"icon\" | \"both\"\n  /** Interaction type to open the dropdown. Default: \"hover\" */\n  interactionType?: \"hover\" | \"click\"\n  /** Alignment of the dropdown and icon position. Default: \"left\" */\n  align?: \"left\" | \"right\"\n  /** Padding around the dropdown container in pixels. Default: 4 */\n  containerPadding?: number\n  /** Gap between dropdown items in pixels. Default: 4 */\n  containerGap?: number\n  /** Auto-close dropdown after item selection. Default: true for click mode, false for hover */\n  closeOnSelect?: boolean\n  /** Callback fired when dropdown open state changes */\n  onOpenChange?: (open: boolean) => void\n  /** Disable the entire dropdown */\n  disabled?: boolean\n  /** Accessible label for the trigger button */\n  ariaLabel?: string\n}\n\ntype ItemElement<TId extends string = string> = ReactElement<{\n  id: TId\n  disabled?: boolean\n  isDefault?: boolean\n  inDropdown?: boolean\n  tabIndex?: number\n}>\n\n/**\n * A dropdown that opens inline with smooth hover or click interactions\n *\n * The inline dropdown displays a single item (trigger) by default and expands to show\n * all items when hovered or clicked. The dropdown intelligently positions itself to align the\n * default item in the dropdown with the trigger button, maintaining visual continuity.\n *\n * @param children - The dropdown items to render\n * @param defaultItemId - The ID of the item to show as the default trigger\n * @param mode - Display mode for the trigger button (default: \"icon\")\n * @param interactionType - Interaction type to open the dropdown (default: \"hover\")\n * @param align - Alignment of the dropdown and icon position (default: \"left\")\n * @param containerPadding - Padding around the dropdown container in pixels (default: 4)\n * @param containerGap - Gap between dropdown items in pixels (default: 4)\n * @param className - Additional CSS classes to apply to the container\n *\n * @example Basic usage with hover\n * <TtpInlineDropdown defaultItemId=\"view-code\" mode=\"icon\">\n *   <TtpInlineDropdownItem id=\"view-code\">\n *     <TtpInlineDropdownItemIcon><Icon /></TtpInlineDropdownItemIcon>\n *     <TtpInlineDropdownItemLabel>View Code</TtpInlineDropdownItemLabel>\n *   </TtpInlineDropdownItem>\n * </TtpInlineDropdown>\n *\n * @example With right alignment\n * <TtpInlineDropdown defaultItemId=\"edit\" align=\"right\">\n *   ...items\n * </TtpInlineDropdown>\n */\nexport const TtpInlineDropdown = ({\n  children,\n  className,\n  defaultItemId,\n  mode = \"icon\",\n  interactionType = \"hover\",\n  align = \"left\",\n  containerPadding = 4,\n  containerGap = 4,\n  closeOnSelect,\n  onOpenChange,\n  disabled = false,\n  ariaLabel,\n}: TtpInlineDropdownProps) => {\n  const [isOpen, setIsOpen] = useState(false)\n  const [focusedIndex, setFocusedIndex] = useState<number | null>(null)\n  const defaultItemRef = useRef<HTMLDivElement>(null)\n  const containerRef = useRef<HTMLButtonElement>(null)\n  const dropdownRef = useRef<HTMLDivElement>(null)\n  const uniqueId = useId()\n\n  // Helper to get button element by index\n  const getItemButton = (index: number): HTMLButtonElement | null => {\n    const itemWrapper = dropdownRef.current?.querySelector(\n      `[data-item-index=\"${index}\"]`\n    )\n    return itemWrapper?.querySelector(\"button\") as HTMLButtonElement | null\n  }\n  const menuId = `dropdown-menu-${uniqueId}`\n  const triggerId = `dropdown-trigger-${uniqueId}`\n  const childrenArray = Children.toArray(children)\n\n  // Validation: Check for valid children\n  const validItems = useMemo(() => {\n    return childrenArray.filter(\n      (child): child is ItemElement =>\n        isValidElement(child) &&\n        typeof child.props === \"object\" &&\n        child.props !== null &&\n        \"id\" in child.props &&\n        typeof child.props.id === \"string\"\n    )\n  }, [childrenArray])\n\n  // Dev-mode validation warnings\n  useEffect(() => {\n    if (process.env.NODE_ENV === \"development\") {\n      // Check for empty children\n      if (validItems.length === 0) {\n        console.warn(\n          \"[TtpInlineDropdown] No valid TtpInlineDropdownItem children found. At least one item is required.\"\n        )\n      }\n\n      // Check for duplicate IDs\n      const ids: string[] = validItems.map(\n        (item: ItemElement) => item.props.id as string\n      )\n      const duplicates: string[] = ids.filter(\n        (id: string, index: number) => ids.indexOf(id) !== index\n      )\n      if (duplicates.length > 0) {\n        console.warn(\n          `[TtpInlineDropdown] Duplicate item IDs found: ${duplicates.join(\", \")}. Each item must have a unique ID.`\n        )\n      }\n\n      // Check for invalid defaultItemId\n      if (defaultItemId && !ids.includes(defaultItemId)) {\n        console.warn(\n          `[TtpInlineDropdown] defaultItemId \"${defaultItemId}\" not found in children. Falling back to first item.`\n        )\n      }\n    }\n  }, [validItems, defaultItemId])\n\n  const defaultItemIndex = validItems.findIndex(\n    (child): child is ItemElement =>\n      isValidElement(child) &&\n      typeof child.props === \"object\" &&\n      child.props !== null &&\n      \"id\" in child.props &&\n      child.props.id === defaultItemId\n  )\n\n  const actualDefaultIndex = defaultItemIndex !== -1 ? defaultItemIndex : 0\n  const defaultItem = validItems[actualDefaultIndex] as ItemElement | undefined\n\n  // Calculate closeOnSelect default based on interactionType\n  const shouldCloseOnSelect =\n    closeOnSelect !== undefined ? closeOnSelect : interactionType === \"click\"\n\n  const handleOpenChange = useCallback(\n    (open: boolean) => {\n      setIsOpen(open)\n      onOpenChange?.(open)\n      if (!open) {\n        setFocusedIndex(null)\n        // Return focus to trigger when closing\n        if (interactionType === \"click\") {\n          setTimeout(() => {\n            containerRef.current?.focus()\n          }, 0)\n        }\n      } else if (interactionType === \"click\" && open) {\n        // Auto-focus first item when opening in click mode\n        setTimeout(() => {\n          const firstEnabledIndex = validItems.findIndex(\n            (item: ItemElement) => !(item.props.disabled as boolean | undefined)\n          )\n          if (firstEnabledIndex !== -1) {\n            setFocusedIndex(firstEnabledIndex)\n            getItemButton(firstEnabledIndex)?.focus()\n          }\n        }, 100)\n      }\n    },\n    [interactionType, onOpenChange, validItems]\n  )\n\n  // Calculate the top offset based on the default item's position\n  // Get the actual height from the DOM element\n  const itemHeight = defaultItemRef.current?.offsetHeight || 32\n  const topOffset =\n    actualDefaultIndex * (itemHeight + containerGap) + containerPadding\n\n  // Get enabled items for keyboard navigation\n  const enabledItems = useMemo(() => {\n    return validItems\n      .map((item: ItemElement, index: number) => ({ item, index }))\n      .filter(\n        ({ item }: { item: ItemElement }) =>\n          !(item.props.disabled as boolean | undefined)\n      )\n  }, [validItems])\n\n  // Handle click outside to close dropdown when in click mode\n  useEffect(() => {\n    if (interactionType !== \"click\" || !isOpen || disabled) {\n      return\n    }\n\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        containerRef.current &&\n        !containerRef.current.contains(event.target as Node) &&\n        dropdownRef.current &&\n        !dropdownRef.current.contains(event.target as Node)\n      ) {\n        handleOpenChange(false)\n      }\n    }\n\n    document.addEventListener(\"mousedown\", handleClickOutside)\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside)\n    }\n  }, [interactionType, isOpen, disabled, handleOpenChange])\n\n  const handleToggle = () => {\n    if (disabled) {\n      return\n    }\n    if (interactionType === \"click\") {\n      handleOpenChange(!isOpen)\n    }\n  }\n\n  const handleMouseEnter = () => {\n    if (disabled) {\n      return\n    }\n    if (interactionType === \"hover\") {\n      handleOpenChange(true)\n    }\n  }\n\n  const handleMouseLeave = () => {\n    if (disabled) {\n      return\n    }\n    if (interactionType === \"hover\") {\n      handleOpenChange(false)\n    }\n  }\n\n  const handleItemSelect = () => {\n    if (shouldCloseOnSelect) {\n      handleOpenChange(false)\n    }\n  }\n\n  // Keyboard navigation handlers\n  const handleTriggerKeyDown = (e: React.KeyboardEvent) => {\n    if (disabled) {\n      return\n    }\n\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault()\n      if (interactionType === \"click\") {\n        handleToggle()\n      }\n    } else if (e.key === \"ArrowDown\" && isOpen) {\n      e.preventDefault()\n      const firstEnabledIndex = enabledItems[0]?.index ?? 0\n      setFocusedIndex(firstEnabledIndex)\n      getItemButton(firstEnabledIndex)?.focus()\n    } else if (e.key === \"ArrowUp\" && isOpen) {\n      e.preventDefault()\n      const lastEnabledIndex = enabledItems.at(-1)?.index ?? 0\n      setFocusedIndex(lastEnabledIndex)\n      getItemButton(lastEnabledIndex)?.focus()\n    }\n  }\n\n  const handleDropdownKeyDown = (e: React.KeyboardEvent) => {\n    if (disabled) {\n      return\n    }\n\n    const currentFocused = focusedIndex ?? actualDefaultIndex\n    const currentEnabledIndex = enabledItems.findIndex(\n      ({ index }: { index: number }) => index === currentFocused\n    )\n\n    switch (e.key) {\n      case \"Escape\": {\n        e.preventDefault()\n        handleOpenChange(false)\n        containerRef.current?.focus()\n        break\n      }\n\n      case \"ArrowDown\": {\n        e.preventDefault()\n        if (currentEnabledIndex < enabledItems.length - 1) {\n          const nextItem = enabledItems[currentEnabledIndex + 1]\n          setFocusedIndex(nextItem.index)\n          getItemButton(nextItem.index)?.focus()\n        } else {\n          // Wrap to first\n          const firstItem = enabledItems[0]\n          if (firstItem) {\n            setFocusedIndex(firstItem.index)\n            getItemButton(firstItem.index)?.focus()\n          }\n        }\n        break\n      }\n\n      case \"ArrowUp\": {\n        e.preventDefault()\n        if (currentEnabledIndex > 0) {\n          const prevItem = enabledItems[currentEnabledIndex - 1]\n          setFocusedIndex(prevItem.index)\n          getItemButton(prevItem.index)?.focus()\n        } else {\n          // Wrap to last\n          const lastItem = enabledItems.at(-1)\n          if (lastItem) {\n            setFocusedIndex(lastItem.index)\n            getItemButton(lastItem.index)?.focus()\n          }\n        }\n        break\n      }\n\n      case \"Home\": {\n        e.preventDefault()\n        const firstItem = enabledItems[0]\n        if (firstItem) {\n          setFocusedIndex(firstItem.index)\n          getItemButton(firstItem.index)?.focus()\n        }\n        break\n      }\n\n      case \"End\": {\n        e.preventDefault()\n        const lastItem = enabledItems.at(-1)\n        if (lastItem) {\n          setFocusedIndex(lastItem.index)\n          getItemButton(lastItem.index)?.focus()\n        }\n        break\n      }\n\n      case \"Tab\": {\n        // Close dropdown on Tab\n        handleOpenChange(false)\n        break\n      }\n\n      default:\n        break\n    }\n  }\n\n  return (\n    <InlineDropdownContext.Provider\n      value={{\n        mode,\n        align,\n        onItemSelect: handleItemSelect,\n      }}\n    >\n      <button\n        aria-controls={isOpen ? menuId : undefined}\n        aria-expanded={isOpen}\n        aria-haspopup=\"menu\"\n        aria-label={ariaLabel}\n        className={cn(\n          \"relative inline-flex\",\n          disabled && \"cursor-not-allowed opacity-50\",\n          className\n        )}\n        disabled={disabled}\n        id={triggerId}\n        onClick={handleToggle}\n        onKeyDown={handleTriggerKeyDown}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        ref={containerRef}\n        tabIndex={disabled ? -1 : 0}\n        type=\"button\"\n      >\n        <div ref={defaultItemRef}>\n          {defaultItem &&\n            cloneElement(defaultItem, {\n              isDefault: true,\n            })}\n        </div>\n        <AnimatePresence mode=\"wait\">\n          {isOpen && validItems.length > 0 && (\n            <motion.div\n              animate={{ opacity: 1 }}\n              aria-labelledby={triggerId}\n              className={cn(\n                \"absolute z-50 flex flex-col rounded-xl border border-solid bg-background shadow\"\n              )}\n              exit={{ opacity: 0 }}\n              id={menuId}\n              initial={{ opacity: 0 }}\n              onKeyDown={handleDropdownKeyDown}\n              ref={dropdownRef}\n              role=\"menu\"\n              style={{\n                padding: `${containerPadding}px`,\n                gap: `${containerGap}px`,\n                ...(align === \"left\"\n                  ? { left: `-${containerPadding + 1}px` }\n                  : { right: `-${containerPadding + 1}px` }),\n                top: `-${topOffset + 1}px`,\n              }}\n            >\n              {validItems.map((child: ItemElement, index: number) => {\n                if (!isValidElement(child)) {\n                  return child\n                }\n\n                const isFocused = focusedIndex === index\n                const itemId = child.props.id as string\n\n                // Calculate distance from default item for stagger delay\n                const distanceFromDefault = Math.abs(index - actualDefaultIndex)\n                const isAboveDefault = index < actualDefaultIndex\n                const isBelowDefault = index > actualDefaultIndex\n\n                // Calculate animation direction based on position relative to default\n                let initialY = 0\n                if (isAboveDefault) {\n                  initialY = 8\n                } else if (isBelowDefault) {\n                  initialY = -8\n                }\n\n                return (\n                  <motion.div\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"w-full\"\n                    data-item-index={index}\n                    exit={{ opacity: 0, y: initialY }}\n                    initial={{ opacity: 0, y: initialY }}\n                    key={itemId}\n                    transition={{\n                      duration: 0.2,\n                      delay: distanceFromDefault * 0.05,\n                      ease: \"easeOut\",\n                    }}\n                  >\n                    {cloneElement(child as ItemElement, {\n                      isDefault: index === actualDefaultIndex,\n                      inDropdown: true,\n                      tabIndex: isFocused ? 0 : -1,\n                    })}\n                  </motion.div>\n                )\n              })}\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </button>\n      {/* Screen reader live region */}\n      <div aria-atomic=\"true\" aria-live=\"polite\" className=\"sr-only\">\n        {isOpen\n          ? `Dropdown menu opened with ${validItems.length} item${validItems.length !== 1 ? \"s\" : \"\"}`\n          : \"\"}\n      </div>\n    </InlineDropdownContext.Provider>\n  )\n}\n\nconst itemBaseStyles =\n  \"relative px-2 flex justify-start select-none items-center gap-2 rounded-lg border border-border bg-background text-sm outline-hidden transition-colors hover:bg-accent focus:bg-accent data-disabled:pointer-events-none data-inset:pl-8 data-disabled:opacity-50 data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\"\n\nexport type TtpInlineDropdownItemProps = React.ComponentProps<\n  typeof DropdownMenuPrimitive.Item\n> & {\n  /** Unique identifier for the item */\n  id: string\n  /** The content of the item (typically Icon and Label components) */\n  children: ReactNode\n  /** Click handler for the item */\n  onClick?: () => void\n  /** Disable the item */\n  disabled?: boolean\n  /** Internal prop to mark if this is the default item */\n  isDefault?: boolean\n  /** Internal prop to indicate if item is rendered in the dropdown */\n  inDropdown?: boolean\n}\n\n/**\n * An individual item within the inline dropdown\n *\n * Represents a single actionable item in the dropdown. When used as the default item,\n * it renders as the trigger button. When in the dropdown, it shows both icon and label.\n *\n * @param id - Unique identifier for the item\n * @param children - The content of the item (typically Icon and Label components)\n * @param onClick - Click handler for the item\n * @param className - Additional CSS classes to apply to the item\n *\n * @example\n * <TtpInlineDropdownItem id=\"save\" onClick={handleSave}>\n *   <TtpInlineDropdownItemIcon><SaveIcon /></TtpInlineDropdownItemIcon>\n *   <TtpInlineDropdownItemLabel>Save</TtpInlineDropdownItemLabel>\n * </TtpInlineDropdownItem>\n */\nexport const TtpInlineDropdownItem = ({\n  id: _id,\n  children,\n  onClick,\n  disabled = false,\n  isDefault,\n  inDropdown,\n  ...props\n}: TtpInlineDropdownItemProps) => {\n  const context = useInlineDropdownContext()\n\n  const handleClick = (e: React.MouseEvent) => {\n    if (disabled) {\n      e.preventDefault()\n      e.stopPropagation()\n      return\n    }\n\n    // Stop propagation to prevent triggering the container's onClick\n    if (inDropdown) {\n      e.stopPropagation()\n    }\n    onClick?.()\n    context.onItemSelect?.()\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (disabled) {\n      e.preventDefault()\n      return\n    }\n\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault()\n      onClick?.()\n      context.onItemSelect?.()\n    }\n  }\n\n  const itemProps = {\n    \"aria-disabled\": disabled,\n    disabled,\n    onClick: handleClick,\n    onKeyDown: handleKeyDown,\n    role: inDropdown ? \"menuitem\" : undefined,\n    tabIndex: props.tabIndex,\n  }\n\n  // If this is the default item and not in dropdown, render icon only\n  if (isDefault && !inDropdown && context.mode === \"icon\") {\n    return (\n      <Button\n        {...itemProps}\n        className={itemBaseStyles}\n        size={\"icon-sm\"}\n        variant={\"outline\"}\n      >\n        {Children.toArray(children).find(\n          (child) =>\n            isValidElement(child) &&\n            typeof child.type === \"function\" &&\n            child.type.name === \"TtpInlineDropdownItemIcon\"\n        )}\n      </Button>\n    )\n  }\n\n  return (\n    <Button\n      {...itemProps}\n      className={cn(\n        itemBaseStyles,\n        inDropdown && \"w-full\",\n        context.align === \"right\" &&\n          inDropdown &&\n          \"flex-row-reverse justify-end\"\n      )}\n      size={\"icon-sm\"}\n      variant={\"outline\"}\n    >\n      {children}\n    </Button>\n  )\n}\n\nexport type TtpInlineDropdownItemIconProps = {\n  /** The icon component to render */\n  children: ReactNode\n}\n\n/**\n * Icon wrapper for dropdown items\n *\n * Wraps icon components for consistent sizing and styling within dropdown items.\n * Icons are automatically sized to 16px (size-4) by the parent item styles.\n *\n * @param children - The icon component to render\n *\n * @example\n * <TtpInlineDropdownItemIcon>\n *   <HugeiconsIcon icon={SourceCodeIcon} />\n * </TtpInlineDropdownItemIcon>\n */\nexport const TtpInlineDropdownItemIcon = ({\n  children,\n}: TtpInlineDropdownItemIconProps) => {\n  return children\n}\n\nexport type TtpInlineDropdownItemLabelProps = {\n  /** The text label to display */\n  children: ReactNode\n}\n\n/**\n * Label component for dropdown items\n *\n * Displays text labels for dropdown items. Hidden when the item is used as the\n * trigger button in \"icon\" mode, visible in the expanded dropdown.\n * Text size is set to \"text-xs\" (12px) for compact display.\n *\n * @param children - The text label to display\n *\n * @example\n * <TtpInlineDropdownItemLabel>\n *   View Source Code\n * </TtpInlineDropdownItemLabel>\n */\nexport const TtpInlineDropdownItemLabel = ({\n  children,\n}: TtpInlineDropdownItemLabelProps) => {\n  return <span className=\"w-full text-left text-xs\">{children}</span>\n}\n",
      "type": "registry:component"
    }
  ],
  "meta": {
    "category": "navigation-and-menus",
    "tags": ["navigation", "dropdowns"],
    "installCommand": "npx shadcn@latest add https://ui.totheprod.com/r/ttp-inline-dropdown.json"
  }
}
