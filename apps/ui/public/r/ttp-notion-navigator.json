{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ttp-notion-navigator",
  "type": "registry:block",
  "title": "Notion Navigator",
  "description": "Hierarchical navigation sidebar with collapsible sections",
  "dependencies": ["motion", "framer-motion"],
  "files": [
    {
      "path": "components/ui/totheprod-ui/ttp-notion-navigator.tsx",
      "content": "/** biome-ignore-all lint/a11y/noNoninteractiveElementInteractions: Mouse tracking is for decorative animation effect */\n\"use client\"\n\nimport { motion } from \"framer-motion\"\nimport { useEffect, useRef, useState } from \"react\"\nimport { cn } from \"@/lib/utils\"\n\ntype TtpNotionNavigatorProps = {\n  /** Additional CSS classes to apply to the container */\n  className?: string\n  /** The ID of the scroll container to use, defaults to \"body\" */\n  scrollContainerId?: string\n}\n\nconst StyleMap = {\n  H1: {\n    barWidth: \"w-4\",\n    text: \"ml-0\",\n  },\n  H2: {\n    barWidth: \"w-3\",\n    text: \"ml-2\",\n  },\n  H3: {\n    barWidth: \"w-2\",\n    text: \"ml-4\",\n  },\n  H4: {\n    barWidth: \"w-1\",\n    text: \"ml-6\",\n  },\n  H5: {\n    barWidth: \"w-1\",\n    text: \"ml-6\",\n  },\n  H6: {\n    barWidth: \"w-1\",\n    text: \"ml-6\",\n  },\n} as const\n\nconst getStyle = (heading: keyof typeof StyleMap) => {\n  return StyleMap[heading]\n}\n\nexport const TtpNotionNavigator = ({\n  className,\n  scrollContainerId,\n}: TtpNotionNavigatorProps) => {\n  const [headings, setHeadings] = useState<HTMLHeadingElement[]>([])\n  const [isHovering, setisHovering] = useState(true)\n  const [activeHeadingId, setActiveHeadingId] = useState<string | null>(null)\n  const observerRef = useRef<IntersectionObserver | null>(null)\n\n  const handleScrollToHeading = (heading: HTMLHeadingElement) => {\n    // Use ID to find the heading fresh from DOM (more reliable than stored reference)\n    const headingId = heading.id\n    const targetHeading = document.getElementById(headingId)\n\n    if (!targetHeading) {\n      return\n    }\n\n    const offset = 100 // Offset from top of viewport/container\n\n    if (scrollContainerId) {\n      const scrollContainer = document.getElementById(scrollContainerId)\n      if (scrollContainer?.contains(targetHeading)) {\n        // Calculate absolute positions to get consistent relative position\n        // This avoids viewport-relative calculations that change with scroll\n        const getAbsoluteTop = (el: HTMLElement) => {\n          let top = 0\n          let current = el as HTMLElement | null\n          while (current) {\n            top += current.offsetTop\n            current = current.offsetParent as HTMLElement | null\n          }\n          return top\n        }\n\n        const elementAbsoluteTop = getAbsoluteTop(targetHeading)\n        const containerAbsoluteTop = getAbsoluteTop(scrollContainer)\n        const relativeTop = elementAbsoluteTop - containerAbsoluteTop\n\n        const scrollPosition = relativeTop - offset\n\n        scrollContainer.scrollTo({\n          top: Math.max(0, scrollPosition), // Ensure non-negative\n          behavior: \"smooth\",\n        })\n      }\n    } else {\n      // Calculate absolute position relative to document\n      let absoluteTop = 0\n      let element = targetHeading as HTMLElement | null\n      while (element) {\n        absoluteTop += element.offsetTop\n        element = element.offsetParent as HTMLElement | null\n      }\n\n      window.scrollTo({\n        top: absoluteTop - offset,\n        behavior: \"smooth\",\n      })\n    }\n  }\n\n  useEffect(() => {\n    const headingElements = Array.from(\n      document.querySelectorAll(\"h1, h2, h3, h4, h5, h6\")\n    ) as HTMLHeadingElement[]\n\n    // Ensure each heading has an ID for tracking\n    for (const [index, heading] of headingElements.entries()) {\n      if (!heading.id) {\n        heading.id = `heading-${index}`\n      }\n    }\n\n    setHeadings(headingElements)\n\n    // Create Intersection Observer\n    observerRef.current = new IntersectionObserver(\n      (entries) => {\n        // Find the entry with the highest intersection ratio that's intersecting\n        const visibleEntries = entries.filter((entry) => entry.isIntersecting)\n\n        if (visibleEntries.length > 0) {\n          // Sort by intersection ratio (highest first) and then by position (topmost first)\n          visibleEntries.sort((a, b) => {\n            const ratioDiff = b.intersectionRatio - a.intersectionRatio\n            if (Math.abs(ratioDiff) > 0.1) {\n              return ratioDiff\n            }\n            // If ratios are similar, prefer the one closer to the top\n            return a.boundingClientRect.top - b.boundingClientRect.top\n          })\n\n          const mostVisible = visibleEntries[0]\n          if (mostVisible.target.id) {\n            setActiveHeadingId(mostVisible.target.id)\n          }\n        } else {\n          // If no headings are intersecting, find the one closest to the top\n          const sortedByPosition = [...entries].sort(\n            (a, b) => a.boundingClientRect.top - b.boundingClientRect.top\n          )\n          const closest = sortedByPosition.find(\n            (entry) => entry.boundingClientRect.top >= 0\n          )\n          if (closest?.target.id) {\n            setActiveHeadingId(closest.target.id)\n          }\n        }\n      },\n      {\n        rootMargin: \"-20% 0px -70% 0px\", // Trigger when heading is in the top 30% of viewport\n        threshold: [0, 0.25, 0.5, 0.75, 1],\n      }\n    )\n\n    // Observe all headings\n    for (const heading of headingElements) {\n      observerRef.current?.observe(heading)\n    }\n\n    // Cleanup\n    return () => {\n      for (const heading of headingElements) {\n        observerRef.current?.unobserve(heading)\n      }\n      observerRef.current?.disconnect()\n    }\n  }, [])\n\n  return headings.length > 0 ? (\n    <motion.div\n      className={cn(\n        \"-translate-y-1/2 fixed top-1/2 right-4 flex h-max max-h-[75vh] w-max flex-col items-end overflow-y-auto shadow-none transition-all\",\n        isHovering &&\n          \"rounded-lg border border-border/25 bg-muted/50 py-2 pr-3 pl-3 shadow-xl\",\n        className\n      )}\n      onMouseLeave={() => setisHovering(false)}\n    >\n      {headings.map((heading) => {\n        const isActive = heading.id === activeHeadingId\n        return (\n          <button\n            aria-label={`Scroll to ${heading.textContent}`}\n            className=\"group flex w-full cursor-pointer items-stretch justify-between\"\n            key={heading.id}\n            onClick={() => handleScrollToHeading(heading)}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\" || e.key === \" \") {\n                e.preventDefault()\n                handleScrollToHeading(heading)\n              }\n            }}\n            type=\"button\"\n          >\n            <motion.div\n              animate={\n                isHovering\n                  ? { opacity: 1, x: 0, height: \"auto\" }\n                  : { opacity: 0, x: -10, height: 0 }\n              }\n              className={cn(\n                \"mb-0.5 line-clamp-1 w-full max-w-[200px] flex-1 text-left font-medium text-xs\",\n                isActive\n                  ? \"text-foreground/75 dark:text-foreground\"\n                  : \"text-muted-foreground/50 dark:text-muted-foreground\",\n                isHovering &&\n                  \"group-hover:text-foreground/75 dark:group-hover:text-foreground\",\n                getStyle(heading.tagName as keyof typeof StyleMap).text\n              )}\n              initial={{ opacity: 0, x: -10, height: 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              {heading.textContent}\n            </motion.div>\n            {/** biome-ignore lint/a11y/noStaticElementInteractions: Decorative hover animation */}\n            <div\n              className=\"flex h-[unset] items-center justify-center py-1 pl-2\"\n              onMouseEnter={() => setisHovering(true)}\n            >\n              <div\n                className={cn(\n                  \"h-[2px] rounded-full transition-colors\",\n                  isActive\n                    ? \"bg-foreground/75 dark:bg-foreground\"\n                    : \"bg-muted-foreground/25 dark:bg-muted-foreground/50\",\n                  isHovering &&\n                    \"group-hover:bg-foreground/75 dark:group-hover:bg-foreground\",\n                  getStyle(heading.tagName as keyof typeof StyleMap).barWidth\n                )}\n              />\n            </div>\n          </button>\n        )\n      })}\n    </motion.div>\n  ) : null\n}\n",
      "type": "registry:component"
    }
  ],
  "meta": {
    "category": "base-components",
    "tags": ["navigation", "sidebar", "hierarchy", "collapsible"],
    "installCommand": "npx shadcn@latest add https://ui.totheprod.com/r/ttp-notion-navigator.json"
  }
}
