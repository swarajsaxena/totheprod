{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ttp-cursor-comet",
  "type": "registry:block",
  "title": "Cursor Comet",
  "description": "Trailing comet effect that follows cursor movement",
  "dependencies": ["motion", "framer-motion"],
  "files": [
    {
      "path": "components/ui/totheprod-ui/ttp-cursor-comet.tsx",
      "content": "\"use client\"\n\nimport { motion } from \"framer-motion\"\nimport { useEffect, useRef, useState } from \"react\"\nimport { cn } from \"@/lib/utils\"\n\ntype TtpCursorCometProps = {\n  className?: string\n  rowAndColCount?: number\n  cometRadius?: number\n  trailFadeSpeed?: number\n  radialOpacityFade?: number\n  symbols?: string[]\n}\n\ntype BoxState = {\n  opacity: number\n  timestamp: number\n  distance: number\n  centerCol: number\n  centerRow: number\n  isActive: boolean\n  symbol: string\n}\n\nexport const TtpCursorComet = ({\n  className,\n  rowAndColCount = 30,\n  cometRadius = 4,\n  trailFadeSpeed = 0.03,\n  radialOpacityFade = 0,\n  symbols = [\"!\", \"@\", \"#\", \"$\", \"%\", \"^\", \"&\", \"*\", \"-\", \"+\", \";\", \"{\", \"}\"],\n}: TtpCursorCometProps) => {\n  const [boxStates, setBoxStates] = useState<Record<string, BoxState>>({})\n  const containerRef = useRef<HTMLDivElement>(null)\n  const animationFrameRef = useRef<number | undefined>(undefined)\n  const lastHoveredBoxRef = useRef<{ row: number; col: number } | null>(null)\n\n  const getRandomSymbol = (): string => {\n    return symbols[Math.floor(Math.random() * symbols.length)]\n  }\n\n  // Fade out trail effect - both opacity and radius shrink\n  useEffect(() => {\n    const fadeTrail = () => {\n      setBoxStates((prevStates) => {\n        const newStates: Record<string, BoxState> = {}\n\n        // biome-ignore lint/complexity/noForEach: Animation state updates require forEach for clarity\n        Object.entries(prevStates).forEach(([key, state]) => {\n          const [rowStr, colStr] = key.split(\"-\")\n          const row = Number.parseInt(rowStr, 10)\n          const col = Number.parseInt(colStr, 10)\n\n          // Calculate current distance from the original center\n          const currentDistance = Math.sqrt(\n            (col - state.centerCol) ** 2 + (row - state.centerRow) ** 2\n          )\n\n          // Reduce opacity\n          const newOpacity = state.opacity - trailFadeSpeed\n\n          // Calculate shrinking radius based on opacity\n          // As opacity decreases, the effective radius shrinks proportionally\n          const effectiveRadius = cometRadius * (newOpacity / 1)\n\n          // Keep the box only if it's within the shrinking radius and still has opacity\n          if (newOpacity > 0 && currentDistance <= effectiveRadius) {\n            newStates[key] = {\n              opacity: newOpacity,\n              timestamp: state.timestamp,\n              distance: state.distance,\n              centerCol: state.centerCol,\n              centerRow: state.centerRow,\n              isActive: false, // Trail boxes are not active\n              symbol: state.symbol, // Keep the same symbol\n            }\n          }\n        })\n\n        return newStates\n      })\n\n      animationFrameRef.current = requestAnimationFrame(fadeTrail)\n    }\n\n    animationFrameRef.current = requestAnimationFrame(fadeTrail)\n\n    return () => {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current)\n      }\n    }\n  }, [trailFadeSpeed, cometRadius])\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (!containerRef.current) {\n      return\n    }\n\n    const rect = containerRef.current.getBoundingClientRect()\n    const x = e.clientX - rect.left\n    const y = e.clientY - rect.top\n\n    const boxWidth = rect.width / rowAndColCount\n    const boxHeight = rect.height / rowAndColCount\n\n    // Calculate which box is being hovered\n    const hoveredCol = Math.floor(x / boxWidth)\n    const hoveredRow = Math.floor(y / boxHeight)\n\n    if (\n      hoveredCol < 0 ||\n      hoveredCol >= rowAndColCount ||\n      hoveredRow < 0 ||\n      hoveredRow >= rowAndColCount\n    ) {\n      return\n    }\n\n    const timestamp = Date.now()\n\n    // Check if we've moved to a different box\n    const hasMovedBox =\n      !lastHoveredBoxRef.current ||\n      lastHoveredBoxRef.current.row !== hoveredRow ||\n      lastHoveredBoxRef.current.col !== hoveredCol\n\n    // Update the last hovered box reference\n    if (hasMovedBox) {\n      lastHoveredBoxRef.current = { row: hoveredRow, col: hoveredCol }\n    }\n\n    // Calculate which boxes fall within the radius and merge with existing trail\n    // biome-ignore lint/complexity/noExcessiveCognitiveComplexity: Complex animation logic required for cursor comet effect\n    setBoxStates((prevStates) => {\n      const newBoxStates: Record<string, BoxState> = { ...prevStates }\n\n      // First, mark all existing boxes as inactive (trailing)\n      // biome-ignore lint/complexity/noForEach: State mutation pattern requires forEach\n      Object.keys(newBoxStates).forEach((key) => {\n        if (newBoxStates[key]) {\n          newBoxStates[key] = { ...newBoxStates[key], isActive: false }\n        }\n      })\n\n      for (let row = 0; row < rowAndColCount; row++) {\n        for (let col = 0; col < rowAndColCount; col++) {\n          // Calculate distance from hovered box center to current box center\n          const distance = Math.sqrt(\n            (col - hoveredCol) ** 2 + (row - hoveredRow) ** 2\n          )\n\n          // If within radius, calculate opacity based on distance\n          if (distance <= cometRadius) {\n            // Calculate opacity: if radialOpacityFade is 0, all boxes get full opacity\n            // Otherwise, opacity decreases from 1 (center) to 0 (edge)\n            const opacity =\n              radialOpacityFade === 0\n                ? 1\n                : 1 - (distance / cometRadius) * radialOpacityFade\n            const key = `${row}-${col}`\n\n            // Update box state, keeping the higher opacity if it already exists\n            // Only generate new symbol if we moved to a new box\n            newBoxStates[key] = {\n              opacity: Math.max(opacity, prevStates[key]?.opacity ?? 0),\n              timestamp,\n              distance,\n              centerCol: hoveredCol,\n              centerRow: hoveredRow,\n              isActive: true, // Active comet boxes show symbols\n              symbol: hasMovedBox\n                ? getRandomSymbol() // Generate new symbol only when moved to new box\n                : (prevStates[key]?.symbol ?? getRandomSymbol()), // Keep existing or generate if new\n            }\n          }\n        }\n      }\n\n      return newBoxStates\n    })\n  }\n\n  const handleMouseLeave = () => {\n    // Don't clear immediately, let the trail fade naturally\n    lastHoveredBoxRef.current = null\n  }\n\n  return (\n    // biome-ignore lint/a11y/noStaticElementInteractions: Mouse tracking is for decorative animation effect\n    // biome-ignore lint/a11y/noNoninteractiveElementInteractions: Decorative cursor comet effect\n    <div\n      className={cn(\n        \"absolute top-0 left-0 h-full w-full overflow-hidden\",\n        className\n      )}\n      onMouseLeave={handleMouseLeave}\n      onMouseMove={handleMouseMove}\n      ref={containerRef}\n    >\n      {Array.from({ length: rowAndColCount }).map((_, row) => (\n        <div className=\"flex flex-1 flex-row\" key={row}>\n          {Array.from({ length: rowAndColCount }).map((_, col) => {\n            const key = `${row}-${col}`\n            const boxState = boxStates[key]\n\n            return (\n              <motion.div\n                animate={{\n                  opacity: boxState?.opacity ?? 0,\n                  backgroundColor: boxState\n                    ? \"var(--background)\"\n                    : \"transparent\",\n                }}\n                className=\"flex aspect-square h-[unset] flex-1 select-none items-center justify-center font-mono text-foreground text-sm\"\n                initial={{ opacity: 0, backgroundColor: \"transparent\" }}\n                key={col}\n                transition={{\n                  opacity: { duration: 0, ease: \"easeOut\" },\n                  backgroundColor: { duration: 0, ease: \"easeOut\" },\n                }}\n              >\n                {boxState?.symbol}\n              </motion.div>\n            )\n          })}\n        </div>\n      ))}\n    </div>\n  )\n}\n",
      "type": "registry:component"
    }
  ],
  "meta": {
    "category": "cursor-and-hover-effects",
    "tags": ["cursor", "trail", "comet", "effect"],
    "installCommand": "npx shadcn@latest add https://ui.totheprod.com/r/ttp-cursor-comet.json"
  }
}
